<html> 
  <head> 
    <title>Canvas</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    var $ctx
      $(function(){
        $ctx = $('canvas').get(0).getContext('2d');
        $.extend($ctx, {
          getColor: function(options) {
            if(options.red && options.green && options.blue && options.alpha) {
              return 'rgba('+Math.floor(options.red * 255)+', '+
                Math.floor(options.green*255)+', '+
                Math.floor(options.blue*255)+', '+
                options.alpha+')';
            } else {
              return 'black'
            }
          },
          
          shapes: {
            rainbowCircle: function(options) {
              if (options.created) {
                now = (new Date()).getTime();
                diff = now - options.created;
                options.alpha = (Math.sin(diff/1000.0) / 6.0) + 0.5;
                options.green = (Math.sin(diff/300.0) / 2.0) + 0.5;
                options.blue = (Math.sin(diff/200.0) / 2.0) + 0.5;
                options.red = (Math.sin(diff/500.0) / 2.0) + 0.5;
              }
              
              $ctx.shapes.circle(options);
            },
          
            circle: function(options) {
              if(options.x && options.y) {
                $ctx.fillStyle = options.fillStyle || $ctx.getColor(options);
                $ctx.beginPath();
                $ctx.arc(options.x,  options.y, (options.radius || 20), 0, Math.PI*2, false);
                $ctx.fill();
              }
            }
          },
          
          paintAll: function() {
            $ctx.clearRect(0, 0, $ctx.width, $ctx.height)
            $.each(this.objects, function(){
              $ctx.shapes[this.type](this.data);
            })
            
            if(this.mouse) {this.shapes.circle(this.mouse)}
          },
          
          animate: function(timeout){
            $ctx.startedAt = $ctx.startedAt || (new Date()).getTime();
            $ctx.framesPainted = $ctx.framesPainted + 1 || 1

            $ctx.paintAll();
            
            timeout = timeout || 50;

            if ($ctx.framesPainted > 10) {
              fps = $ctx.framesPainted / ((new Date()).getTime() - $ctx.startedAt) * 1000
              timeout = (timeout + (1000 / fps))/2.0 - 2;
              $ctx.fillStyle = "black"
              $ctx.font = "15pt Arial"
              $ctx.fillText(Math.round(fps * 10)/10 + " f/s", 10, 25)
              $ctx.fillText('timeout '+Math.round(timeout * 10)/10 + "s", 10, 50)
            }
            
            setTimeout(function(){$ctx.animate(timeout)}, timeout);
          },
          
          objects: [],
          
          addObject: function(object) {
            object.data.created = (new Date()).getTime();
            $ctx.objects.push(object)
          }
        });
        
        
        $('canvas')
          .mousemove(function(e){
            if(e) {
            $ctx.mouse = {
              x: e.clientX - $(this).position().left,
              y: e.clientY - $(this).position().top
            }
            if ($ctx.mousedown) {
              $ctx.addObject({
                type: 'rainbowCircle',
                data: {
                  x: $ctx.mouse.x,
                  y: $ctx.mouse.y
                }
              }
            )};
          }
          }).mousedown(function(e){
            $ctx.mousedown = true;
          }).mouseup(function(e){
            $ctx.mousedown = false;
          }).resize(function(){
            $ctx.width = $(this).width();
            $ctx.height = $(this).height();
          })
        
        
    
        $(window).resize(function(){
          $('canvas')
            .attr('width',$('body').width())
            .attr('height', $('body').height())
            .resize()
            .mousemove();
        }).resize()
        
        $ctx.animate(10);
     });
     
     $(document).keyup(function(e){
       switch(e.keyCode) {
         case 76: $.getJSON('json.js', function(data){ $ctx.objects = data }); break
         case 67: $ctx.objects = [];  break
       }
     })
    </script> 
    <style type="text/css"> 
      body { cursor:none; width: 100%; height: 100%; padding:0; margin:0;}
      canvas { cursor: none; padding:0;margin:0;}
    </style> 
  </head> 
 
  <body><canvas></canvas></body> 
 
</html>